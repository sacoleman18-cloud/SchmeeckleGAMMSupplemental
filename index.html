<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Supplemental materials for the Bat Activity Study analyzing differences in call frequency across habitats using GAMMs.">
  <title>Supplemental Materials — Bat Activity Study</title>

  <!-- Plotly for interactive plots -->
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

  <!-- jQuery (required for DataTables) -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

  <!-- DataTables CSS -->
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.7/css/jquery.dataTables.min.css">

  <!-- DataTables JS -->
  <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>

  <!-- PapaParse for CSV parsing -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <style>
    /* ============================================
       Base Styles
       ============================================ */
    * {
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      line-height: 1.7;
      padding: 40px 20px;
      background-color: #fafafa;
      color: #2c3e50;
    }

    /* ============================================
       Typography
       ============================================ */
    h1 {
      font-size: 2.2em;
      font-weight: 600;
      color: #1a1a1a;
      margin-bottom: 10px;
      border-bottom: 3px solid #2c3e50;
      padding-bottom: 15px;
    }

    h2 {
      font-size: 1.8em;
      font-weight: 600;
      color: #2c3e50;
      margin-top: 0;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 2px solid #e0e0e0;
    }

    h3 {
      font-size: 1.3em;
      font-weight: 600;
      color: #34495e;
      margin-top: 25px;
      margin-bottom: 15px;
    }

    p {
      margin: 12px 0;
      color: #555;
    }

    /* ============================================
       Section Containers
       ============================================ */
    .section {
      background-color: #ffffff;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      padding: 35px;
      margin-bottom: 40px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }

    .section-intro {
      font-size: 1.05em;
      color: #555;
      margin-bottom: 30px;
      line-height: 1.8;
    }

    /* ============================================
       Links and Buttons
       ============================================ */
    a {
      color: #2980b9;
      text-decoration: none;
      transition: color 0.2s ease;
    }

    a:hover {
      color: #1f5f8b;
      text-decoration: underline;
    }

    .download-button {
      display: inline-block;
      padding: 12px 24px;
      background-color: #2980b9;
      color: #ffffff;
      border-radius: 6px;
      font-size: 0.95em;
      font-weight: 500;
      margin-top: 8px;
      margin-bottom: 12px;
      transition: background-color 0.2s ease, transform 0.1s ease;
      border: none;
      cursor: pointer;
      text-decoration: none;
    }

    .download-button:hover {
      background-color: #1f5f8b;
      transform: translateY(-1px);
      text-decoration: none;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
    }

    .download-button:active {
      transform: translateY(0);
    }

    .report-link {
      display: inline-block;
      padding: 12px 24px;
      background-color: #27ae60;
      color: #ffffff;
      border-radius: 6px;
      font-size: 0.95em;
      font-weight: 500;
      margin-top: 8px;
      margin-bottom: 12px;
      transition: background-color 0.2s ease, transform 0.1s ease;
      text-decoration: none;
    }

    .report-link:hover {
      background-color: #1e8449;
      transform: translateY(-1px);
      text-decoration: none;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
    }

    .github-link {
      display: inline-block;
      padding: 10px 20px;
      background-color: #6c757d;
      color: #ffffff;
      border-radius: 6px;
      font-size: 0.9em;
      font-weight: 500;
      margin-top: 8px;
      transition: background-color 0.2s ease;
      text-decoration: none;
    }

    .github-link:hover {
      background-color: #5a6268;
      text-decoration: none;
    }

    /* ============================================
       Item Containers
       ============================================ */
    .item-container {
      margin-bottom: 30px;
      padding-bottom: 25px;
      border-bottom: 1px solid #f0f0f0;
    }

    .item-container:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }

    .item-description {
      margin-top: 8px;
      margin-bottom: 0;
      color: #666;
      font-size: 0.95em;
      line-height: 1.6;
    }

    /* ============================================
       Subsection Styling
       ============================================ */
    .subsection {
      margin-top: 30px;
      padding-top: 25px;
      border-top: 1px solid #f0f0f0;
    }

    .subsection:first-child {
      border-top: none;
      padding-top: 0;
      margin-top: 0;
    }

    /* ============================================
       Figure Thumbnails
       ============================================ */
    .figure-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 15px;
    }

    .figure-item {
      text-align: center;
    }

    .figure-thumb {
      max-width: 100%;
      height: auto;
      border: 2px solid #e0e0e0;
      border-radius: 6px;
      padding: 4px;
      background-color: #fff;
      transition: border-color 0.2s ease, transform 0.2s ease;
      cursor: pointer;
      display: block;
      margin: 0 auto 8px;
    }

    .figure-thumb:hover {
      border-color: #2980b9;
      transform: scale(1.02);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .figure-caption {
      font-size: 0.9em;
      color: #666;
      margin-top: 5px;
    }

    /* ============================================
       Interactive Plot Container
       ============================================ */
    .interactive-container {
      background: #ffffff;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      padding: 20px;
      margin-top: 20px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }

    #interactivePlot {
      width: 100%;
      height: 500px;
    }

    /* ============================================
       DataTables Styling
       ============================================ */
    .table-container {
      margin-top: 25px;
      background: #ffffff;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      overflow-x: auto;
    }

    .table-wrapper {
      overflow-x: auto;
      margin-top: 15px;
    }

    table.dataTable {
      width: 100% !important;
      border-collapse: separate;
      border-spacing: 0;
      font-size: 0.9em;
    }

    table.dataTable thead th {
      background-color: #f8f9fa;
      color: #2c3e50;
      font-weight: 600;
      padding: 12px 10px;
      border-bottom: 2px solid #e0e0e0;
      text-align: left;
      position: sticky;
      top: 0;
      z-index: 10;
    }

    table.dataTable thead th.sorting,
    table.dataTable thead th.sorting_asc,
    table.dataTable thead th.sorting_desc {
      cursor: pointer;
      position: relative;
      padding-right: 30px;
    }

    table.dataTable thead th.sorting:after,
    table.dataTable thead th.sorting_asc:after,
    table.dataTable thead th.sorting_desc:after {
      position: absolute;
      right: 8px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 0.8em;
      color: #2980b9;
    }

    table.dataTable tbody td {
      padding: 10px;
      border-bottom: 1px solid #f0f0f0;
      color: #555;
    }

    table.dataTable tbody tr:hover {
      background-color: #f8f9fa;
    }

    table.dataTable tbody tr.even {
      background-color: #ffffff;
    }

    table.dataTable tbody tr.odd {
      background-color: #fafafa;
    }

    .dataTables_wrapper .dataTables_filter {
      margin-bottom: 15px;
    }

    .dataTables_wrapper .dataTables_filter input {
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 6px 10px;
      font-size: 0.9em;
      margin-left: 8px;
    }

    .dataTables_wrapper .dataTables_filter input:focus {
      outline: none;
      border-color: #2980b9;
      box-shadow: 0 0 0 2px rgba(41, 128, 185, 0.1);
    }

    .dataTables_wrapper .dataTables_length {
      margin-bottom: 15px;
    }

    .dataTables_wrapper .dataTables_length select {
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 4px 8px;
      font-size: 0.9em;
      margin: 0 5px;
    }

    .dataTables_wrapper .dataTables_info {
      color: #666;
      font-size: 0.9em;
      padding-top: 10px;
    }

    .dataTables_wrapper .dataTables_paginate {
      padding-top: 10px;
    }

    .dataTables_wrapper .dataTables_paginate .paginate_button {
      padding: 6px 12px;
      margin: 0 2px;
      border: 1px solid #ddd;
      border-radius: 4px;
      color: #2980b9 !important;
      background: #fff !important;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .dataTables_wrapper .dataTables_paginate .paginate_button:hover {
      background: #2980b9 !important;
      color: #fff !important;
      border-color: #2980b9;
    }

    .dataTables_wrapper .dataTables_paginate .paginate_button.current {
      background: #2980b9 !important;
      color: #fff !important;
      border-color: #2980b9;
    }

    .dataTables_wrapper .dataTables_paginate .paginate_button.disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .table-loading {
      text-align: center;
      padding: 40px;
      color: #666;
      font-style: italic;
    }

    .table-error {
      text-align: center;
      padding: 40px;
      color: #e74c3c;
      background-color: #fee;
      border-radius: 6px;
      border: 1px solid #fcc;
    }

    /* ============================================
       Responsive Design
       ============================================ */
    @media (max-width: 768px) {
      body {
        padding: 20px 15px;
      }

      h1 {
        font-size: 1.8em;
      }

      h2 {
        font-size: 1.5em;
      }

      .section {
        padding: 25px 20px;
      }

      .figure-grid {
        grid-template-columns: 1fr;
      }

      .table-container {
        padding: 15px;
      }

      .dataTables_wrapper .dataTables_length,
      .dataTables_wrapper .dataTables_filter {
        text-align: left;
        margin-bottom: 10px;
      }

      .dataTables_wrapper .dataTables_length select,
      .dataTables_wrapper .dataTables_filter input {
        width: 100%;
        margin: 5px 0;
      }

      table.dataTable {
        font-size: 0.85em;
      }

      table.dataTable thead th,
      table.dataTable tbody td {
        padding: 8px 6px;
      }
    }

    @media (max-width: 480px) {
      .download-button,
      .report-link,
      .github-link {
        display: block;
        text-align: center;
        width: 100%;
      }
    }
  </style>
</head>

<body>

  <h1>Supplemental Materials</h1>

  <p style="font-size: 1.1em; color: #555; margin-bottom: 40px;">
    This page contains supplemental data, figures, and analysis materials for:
    <strong>Bat Activity Study: Differences in Call Frequency Across Habitats</strong>.
  </p>



  <!-- ============================================
       SECTION 1: NB GAMM Model Materials
       ============================================ -->
  <div class="section">
    <h2>NB GAMM Model Materials</h2>

    <p class="section-intro">
      The materials in this section support a negative binomial generalized additive mixed model (NB GAMM) 
      analysis of bat call frequency across habitats. This analysis accounts for unequal recording effort, 
      temporal variation, and the hierarchical structure of detectors nested within study sites. The model 
      examines differences in total bat calls per night between interior, edge, and open detector placements.
    </p>

    <!-- Model Outputs Subsection -->
    <div class="subsection">
      <h3>Model Outputs</h3>
      <div class="item-container">
        <a href="supplemental/model/model_results.csv" class="download-button" download>
          Download Model Results (CSV)
        </a>
        <p class="item-description">
          Complete NB GAMM model outputs including parameter estimates, confidence intervals, smooth term 
          coefficients, random effects, and model diagnostics (AIC, deviance, R-squared).
        </p>
      </div>
    </div>

    <!-- Diagnostic Figures Subsection -->
    <div class="subsection">
      <h3>Diagnostic Figures</h3>
      <p class="item-description" style="margin-bottom: 15px;">
        Click on any thumbnail to view the full-size diagnostic figure in a new window.
      </p>
      <div class="figure-grid">
        <div class="figure-item">
          <a href="supplemental/figures/residuals_plot.png" target="_blank">
            <img src="supplemental/figures/residuals_plot.png" alt="Residuals Plot" class="figure-thumb">
          </a>
          <p class="figure-caption">Residuals vs. Fitted Values</p>
        </div>
        <div class="figure-item">
          <a href="supplemental/figures/qq_plot.png" target="_blank">
            <img src="supplemental/figures/qq_plot.png" alt="Q-Q Plot" class="figure-thumb">
          </a>
          <p class="figure-caption">Normal Q-Q Plot of Residuals</p>
        </div>
        <div class="figure-item">
          <a href="supplemental/figures/smooth_terms.png" target="_blank">
            <img src="supplemental/figures/smooth_terms.png" alt="Smooth Terms" class="figure-thumb">
          </a>
          <p class="figure-caption">Smooth Term Estimates</p>
        </div>
        <div class="figure-item">
          <a href="supplemental/figures/predicted_vs_observed.png" target="_blank">
            <img src="supplemental/figures/predicted_vs_observed.png" alt="Predicted vs Observed" class="figure-thumb">
          </a>
          <p class="figure-caption">Predicted vs. Observed Values</p>
        </div>
      </div>
    </div>

    <!-- Interactive Visualization Subsection -->
    <div class="subsection">
      <h3>Interactive Visualization</h3>
      <p class="item-description">
        Explore predicted bat call frequencies across habitats using the interactive plot below. 
        Hover over data points to view detailed information.
      </p>
      <div class="interactive-container">
        <div id="interactivePlot"></div>
      </div>
    </div>

    <!-- Analysis Code Repository -->
    <div class="subsection">
      <h3>Analysis Code</h3>
      <div class="item-container">
        <a href="https://github.com/sacoleman18-cloud/SchmeeckleBatGAMMAnalysis" class="github-link" target="_blank">
          View Full Analysis Repository
        </a>
        <p class="item-description">
          GitHub repository containing the complete R code for the NB GAMM analysis, including data preparation, 
          model fitting, diagnostics, and visualization scripts.
        </p>
      </div>
    </div>
  </div>

  <!-- ============================================
       SECTION 2: General Study Materials
       ============================================ -->
  <div class="section">
    <h2>General Study Materials</h2>

    <div class="item-container">
      <a href="supplemental/reports/report.html" class="report-link" target="_blank">
        View Quarto HTML Report
      </a>
      <p class="item-description">
        Comprehensive report containing general plots, tables, and exploratory analyses of bat acoustic activity data.
      </p>
    </div>

    <div class="item-container">
      <a href="supplemental/data/master.csv" class="download-button" download>
        Download Master Dataset (CSV)
      </a>
      <p class="item-description">
        Complete master dataset containing all bat acoustic monitoring records, detector metadata, and environmental covariates.
      </p>

      <!-- Interactive Master Dataset Table -->
      <div class="table-container">
        <h3 style="margin-top: 0; margin-bottom: 10px;">Explore Master Dataset</h3>
        <p class="item-description" style="margin-bottom: 15px;">
          Browse and search the master dataset interactively. The table displays 25 rows per page by default. 
          Use the search box to filter across all columns, click column headers to sort, and scroll horizontally 
          to view all 50 columns. All ~1,500 rows are accessible through pagination.
        </p>
        <div class="table-wrapper">
          <div id="masterTableLoading" class="table-loading">Loading master dataset...</div>
          <div id="masterTableError" class="table-error" style="display: none;"></div>
          <table id="masterTable" class="display" style="width:100%; display: none;"></table>
        </div>
      </div>
    </div>

    <div class="item-container">
      <a href="supplemental/data/calls_per_night.csv" class="download-button" download>
        Download Calls Per Night Dataset (CSV)
      </a>
      <p class="item-description">
        Aggregated dataset summarizing total bat calls per night for each detector, suitable for time-series and habitat comparison analyses.
      </p>

      <!-- Interactive Calls Per Night Table -->
      <div class="table-container">
        <h3 style="margin-top: 0; margin-bottom: 10px;">Explore Calls Per Night Dataset</h3>
        <p class="item-description" style="margin-bottom: 15px;">
          Browse and search the calls-per-night dataset interactively. This table contains ~169 rows with 7 columns. 
          Use the search box to filter data and click column headers to sort. All rows are displayed by default.
        </p>
        <div class="table-wrapper">
          <div id="callsTableLoading" class="table-loading">Loading calls-per-night dataset...</div>
          <div id="callsTableError" class="table-error" style="display: none;"></div>
          <table id="callsTable" class="display" style="width:100%; display: none;"></table>
        </div>
      </div>
    </div>

    <div class="item-container">
      <a href="https://github.com/sacoleman18-cloud/Kpro_Masterfile_Pipeline" class="github-link" target="_blank">
        View Stats & Plotting Pipeline Repository
      </a>
      <p class="item-description">
        GitHub repository containing the complete R code for data processing, statistical analysis, and figure generation.
      </p>
    </div>
  </div>
  
  <!-- ============================================
       Interactive Plot Script
       ============================================ -->
  <script>
    // Example placeholder data — replace with your real GAMM predictions
    // This creates an interactive bar chart showing predicted call frequencies by habitat
    const habitats = ['Interior', 'Edge', 'Open'];
    const predictedMeans = [15.2, 22.8, 18.5];
    const lowerCI = [12.1, 19.3, 15.2];
    const upperCI = [18.3, 26.3, 21.8];

    const trace = {
      x: habitats,
      y: predictedMeans,
      type: 'bar',
      error_y: {
        type: 'data',
        symmetric: false,
        array: upperCI.map((upper, i) => upper - predictedMeans[i]),
        arrayminus: predictedMeans.map((mean, i) => mean - lowerCI[i])
      },
      marker: {
        color: ['#3498db', '#2ecc71', '#e74c3c'],
        line: {
          color: '#2c3e50',
          width: 1.5
        }
      },
      hovertemplate: '<b>Habitat:</b> %{x}<br>' +
                     '<b>Predicted calls/night:</b> %{y:.1f}<br>' +
                     '<b>95% CI:</b> [%{customdata[0]:.1f}, %{customdata[1]:.1f}]<extra></extra>',
      customdata: habitats.map((_, i) => [lowerCI[i], upperCI[i]])
    };

    const layout = {
      title: {
        text: 'Predicted Bat Call Frequency by Habitat Type',
        font: { size: 18, color: '#2c3e50' }
      },
      xaxis: {
        title: {
          text: 'Habitat Type',
          font: { size: 14, color: '#555' }
        },
        tickfont: { size: 12 }
      },
      yaxis: {
        title: {
          text: 'Predicted Calls per Night',
          font: { size: 14, color: '#555' }
        },
        tickfont: { size: 12 }
      },
      margin: { t: 60, l: 70, r: 40, b: 60 },
      plot_bgcolor: '#fafafa',
      paper_bgcolor: '#ffffff',
      showlegend: false
    };

    const config = {
      responsive: true,
      displayModeBar: true,
      modeBarButtonsToRemove: ['pan2d', 'lasso2d'],
      displaylogo: false
    };

    Plotly.newPlot('interactivePlot', [trace], layout, config);
  </script>

  <!-- ============================================
       Interactive Tables Script
       ============================================ -->
  <script>
    // ============================================
    // Master Dataset Table
    // ============================================
    function loadMasterTable() {
      const csvPath = 'supplemental/data/master.csv';
      const loadingEl = document.getElementById('masterTableLoading');
      const errorEl = document.getElementById('masterTableError');
      const tableEl = document.getElementById('masterTable');

      Papa.parse(csvPath, {
        download: true,
        header: true,
        skipEmptyLines: true,
        complete: function(results) {
          if (results.errors.length > 0) {
            loadingEl.style.display = 'none';
            errorEl.style.display = 'block';
            errorEl.textContent = 'Error loading CSV: ' + results.errors[0].message;
            return;
          }

          const data = results.data;
          const columns = results.meta.fields.map(field => ({
            title: field,
            data: field
          }));

          // Initialize DataTable
          const table = $(tableEl).DataTable({
            data: data,
            columns: columns,
            pageLength: 25,
            lengthMenu: [[10, 25, 50, 100, -1], [10, 25, 50, 100, 'All']],
            scrollX: true,
            scrollCollapse: true,
            order: [[0, 'asc']],
            dom: '<"top"lf>rt<"bottom"ip>',
            language: {
              search: 'Search all columns:',
              lengthMenu: 'Show _MENU_ entries',
              info: 'Showing _START_ to _END_ of _TOTAL_ entries',
              infoEmpty: 'No entries to show',
              infoFiltered: '(filtered from _MAX_ total entries)',
              zeroRecords: 'No matching records found'
            },
            columnDefs: [
              {
                targets: '_all',
                className: 'dt-body-left'
              }
            ]
          });

          // Hide loading, show table
          loadingEl.style.display = 'none';
          tableEl.style.display = 'table';
        },
        error: function(error) {
          loadingEl.style.display = 'none';
          errorEl.style.display = 'block';
          errorEl.textContent = 'Error loading CSV file. Please ensure the file exists at: ' + csvPath;
          console.error('PapaParse error:', error);
        }
      });
    }

    // ============================================
    // Calls Per Night Table
    // ============================================
    function loadCallsTable() {
      const csvPath = 'supplemental/data/calls_per_night.csv';
      const loadingEl = document.getElementById('callsTableLoading');
      const errorEl = document.getElementById('callsTableError');
      const tableEl = document.getElementById('callsTable');

      Papa.parse(csvPath, {
        download: true,
        header: true,
        skipEmptyLines: true,
        complete: function(results) {
          if (results.errors.length > 0) {
            loadingEl.style.display = 'none';
            errorEl.style.display = 'block';
            errorEl.textContent = 'Error loading CSV: ' + results.errors[0].message;
            return;
          }

          const data = results.data;
          const columns = results.meta.fields.map(field => ({
            title: field,
            data: field
          }));

          // Initialize DataTable
          const table = $(tableEl).DataTable({
            data: data,
            columns: columns,
            pageLength: 25,
            lengthMenu: [[10, 25, 50, 100, -1], [10, 25, 50, 100, 'All']],
            order: [[0, 'asc']],
            dom: '<"top"lf>rt<"bottom"ip>',
            language: {
              search: 'Search all columns:',
              lengthMenu: 'Show _MENU_ entries',
              info: 'Showing _START_ to _END_ of _TOTAL_ entries',
              infoEmpty: 'No entries to show',
              infoFiltered: '(filtered from _MAX_ total entries)',
              zeroRecords: 'No matching records found'
            },
            columnDefs: [
              {
                targets: '_all',
                className: 'dt-body-left'
              }
            ]
          });

          // Hide loading, show table
          loadingEl.style.display = 'none';
          tableEl.style.display = 'table';
        },
        error: function(error) {
          loadingEl.style.display = 'none';
          errorEl.style.display = 'block';
          errorEl.textContent = 'Error loading CSV file. Please ensure the file exists at: ' + csvPath;
          console.error('PapaParse error:', error);
        }
      });
    }

    // ============================================
    // Initialize tables when page loads
    // ============================================
    $(document).ready(function() {
      // Load tables after a short delay to ensure all libraries are ready
      setTimeout(function() {
        loadMasterTable();
        loadCallsTable();
      }, 100);
    });
  </script>

</body>
</html>
