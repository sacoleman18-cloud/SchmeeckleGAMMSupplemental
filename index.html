<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Supplemental materials for the Bat Activity Study analyzing differences in call frequency across habitats using GAMMs.">
  <title>Supplemental Materials — Bat Activity Study</title>

  <!-- Plotly for interactive plots -->
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

  <style>
    /* ============================================
       Base Styles
       ============================================ */
    * {
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      line-height: 1.7;
      padding: 40px 20px;
      background-color: #fafafa;
      color: #2c3e50;
    }

    /* ============================================
       Typography
       ============================================ */
    h1 {
      font-size: 2.2em;
      font-weight: 600;
      color: #1a1a1a;
      margin-bottom: 10px;
      border-bottom: 3px solid #2c3e50;
      padding-bottom: 15px;
    }

    h2 {
      font-size: 1.8em;
      font-weight: 600;
      color: #2c3e50;
      margin-top: 0;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 2px solid #e0e0e0;
    }

    h3 {
      font-size: 1.3em;
      font-weight: 600;
      color: #34495e;
      margin-top: 25px;
      margin-bottom: 15px;
    }

    p {
      margin: 12px 0;
      color: #555;
    }

    /* ============================================
       Section Containers
       ============================================ */
    .section {
      background-color: #ffffff;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      padding: 35px;
      margin-bottom: 40px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }

    .section-intro {
      font-size: 1.05em;
      color: #555;
      margin-bottom: 30px;
      line-height: 1.8;
    }

    /* ============================================
       Links and Buttons
       ============================================ */
    a {
      color: #2980b9;
      text-decoration: none;
      transition: color 0.2s ease;
    }

    a:hover {
      color: #1f5f8b;
      text-decoration: underline;
    }

    .download-button {
      display: inline-block;
      padding: 12px 24px;
      background-color: #2980b9;
      color: #ffffff;
      border-radius: 6px;
      font-size: 0.95em;
      font-weight: 500;
      margin-top: 8px;
      margin-bottom: 12px;
      transition: background-color 0.2s ease, transform 0.1s ease;
      border: none;
      cursor: pointer;
      text-decoration: none;
    }

    .download-button:hover {
      background-color: #1f5f8b;
      transform: translateY(-1px);
      text-decoration: none;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
    }

    .download-button:active {
      transform: translateY(0);
    }

    .report-link {
      display: inline-block;
      padding: 12px 24px;
      background-color: #27ae60;
      color: #ffffff;
      border-radius: 6px;
      font-size: 0.95em;
      font-weight: 500;
      margin-top: 8px;
      margin-bottom: 12px;
      transition: background-color 0.2s ease, transform 0.1s ease;
      text-decoration: none;
    }

    .report-link:hover {
      background-color: #1e8449;
      transform: translateY(-1px);
      text-decoration: none;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
    }

    .github-link {
      display: inline-block;
      padding: 10px 20px;
      background-color: #6c757d;
      color: #ffffff;
      border-radius: 6px;
      font-size: 0.9em;
      font-weight: 500;
      margin-top: 8px;
      transition: background-color 0.2s ease;
      text-decoration: none;
    }

    .github-link:hover {
      background-color: #5a6268;
      text-decoration: none;
    }

    /* ============================================
       Item Containers
       ============================================ */
    .item-container {
      margin-bottom: 30px;
      padding-bottom: 25px;
      border-bottom: 1px solid #f0f0f0;
    }

    .item-container:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }

    .item-description {
      margin-top: 8px;
      margin-bottom: 0;
      color: #666;
      font-size: 0.95em;
      line-height: 1.6;
    }

    /* ============================================
       Subsection Styling
       ============================================ */
    .subsection {
      margin-top: 30px;
      padding-top: 25px;
      border-top: 1px solid #f0f0f0;
    }

    .subsection:first-child {
      border-top: none;
      padding-top: 0;
      margin-top: 0;
    }

    /* ============================================
       Figure Thumbnails
       ============================================ */
    .figure-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 15px;
    }

    .figure-item {
      text-align: center;
    }

    .figure-thumb {
      max-width: 100%;
      height: auto;
      border: 2px solid #e0e0e0;
      border-radius: 6px;
      padding: 4px;
      background-color: #fff;
      transition: border-color 0.2s ease, transform 0.2s ease;
      cursor: pointer;
      display: block;
      margin: 0 auto 8px;
    }

    .figure-thumb:hover {
      border-color: #2980b9;
      transform: scale(1.02);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .figure-caption {
      font-size: 0.9em;
      color: #666;
      margin-top: 5px;
    }

    /* ============================================
       Interactive Plot Container
       ============================================ */
    .interactive-container {
      background: #ffffff;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      padding: 20px;
      margin-top: 20px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }

    #interactivePlot {
      width: 100%;
      height: 500px;
    }

    /* ============================================
       Responsive Design
       ============================================ */
    @media (max-width: 768px) {
      body {
        padding: 20px 15px;
      }

      h1 {
        font-size: 1.8em;
      }

      h2 {
        font-size: 1.5em;
      }

      .section {
        padding: 25px 20px;
      }

      .figure-grid {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 480px) {
      .download-button,
      .report-link,
      .github-link {
        display: block;
        text-align: center;
        width: 100%;
      }
    }
  </style>
</head>

<body>

  <h1>Supplemental Materials</h1>

  <p style="font-size: 1.1em; color: #555; margin-bottom: 40px;">
    This page contains supplemental data, figures, and analysis materials for:
    <strong>Bat Activity Study: Differences in Call Frequency Across Habitats</strong>.
  </p>

  <!-- ============================================
       SECTION 1: General Study Materials
       ============================================ -->
  <div class="section">
    <h2>General Study Materials</h2>

    <div class="item-container">
      <a href="supplemental/reports/report.html" class="report-link" target="_blank">
        View Quarto HTML Report
      </a>
      <p class="item-description">
        Comprehensive report containing general plots, tables, and exploratory analyses of bat acoustic activity data.
      </p>
    </div>

    <div class="item-container">
      <a href="supplemental/data/master.csv" class="download-button" download>
        Download Master Dataset (CSV)
      </a>
      <p class="item-description">
        Complete master dataset containing all bat acoustic monitoring records, detector metadata, and environmental covariates.
      </p>
    </div>

    <div class="item-container">
      <a href="supplemental/data/calls_per_night.csv" class="download-button" download>
        Download Calls Per Night Dataset (CSV)
      </a>
      <p class="item-description">
        Aggregated dataset summarizing total bat calls per night for each detector, suitable for time-series and habitat comparison analyses.
      </p>
    </div>

    <div class="item-container">
      <a href="https://github.com/sacoleman18-cloud/Kpro_Masterfile_Pipeline" class="github-link" target="_blank">
        View Stats & Plotting Pipeline Repository
      </a>
      <p class="item-description">
        GitHub repository containing the complete R code for data processing, statistical analysis, and figure generation.
      </p>
    </div>
  </div>

  <!-- ============================================
       SECTION 2: NB GAMM Model Materials
       ============================================ -->
  <div class="section">
    <h2>NB GAMM Model Materials</h2>

    <p class="section-intro">
      The materials in this section support a negative binomial generalized additive mixed model (NB GAMM) 
      analysis of bat call frequency across habitats. This analysis accounts for unequal recording effort, 
      temporal variation, and the hierarchical structure of detectors nested within study sites. The model 
      examines differences in total bat calls per night between interior, edge, and open detector placements.
    </p>

    <!-- Model Outputs Subsection -->
    <div class="subsection">
      <h3>Model Outputs</h3>
      <div class="item-container">
        <a href="supplemental/model/model_results.csv" class="download-button" download>
          Download Model Results (CSV)
        </a>
        <p class="item-description">
          Complete NB GAMM model outputs including parameter estimates, confidence intervals, smooth term 
          coefficients, random effects, and model diagnostics (AIC, deviance, R-squared).
        </p>
      </div>
    </div>

    <!-- Diagnostic Figures Subsection -->
    <div class="subsection">
      <h3>Diagnostic Figures</h3>
      <p class="item-description" style="margin-bottom: 15px;">
        Click on any thumbnail to view the full-size diagnostic figure in a new window.
      </p>
      <div class="figure-grid">
        <div class="figure-item">
          <a href="supplemental/figures/residuals_plot.png" target="_blank">
            <img src="supplemental/figures/residuals_plot.png" alt="Residuals Plot" class="figure-thumb">
          </a>
          <p class="figure-caption">Residuals vs. Fitted Values</p>
        </div>
        <div class="figure-item">
          <a href="supplemental/figures/qq_plot.png" target="_blank">
            <img src="supplemental/figures/qq_plot.png" alt="Q-Q Plot" class="figure-thumb">
          </a>
          <p class="figure-caption">Normal Q-Q Plot of Residuals</p>
        </div>
        <div class="figure-item">
          <a href="supplemental/figures/smooth_terms.png" target="_blank">
            <img src="supplemental/figures/smooth_terms.png" alt="Smooth Terms" class="figure-thumb">
          </a>
          <p class="figure-caption">Smooth Term Estimates</p>
        </div>
        <div class="figure-item">
          <a href="supplemental/figures/predicted_vs_observed.png" target="_blank">
            <img src="supplemental/figures/predicted_vs_observed.png" alt="Predicted vs Observed" class="figure-thumb">
          </a>
          <p class="figure-caption">Predicted vs. Observed Values</p>
        </div>
      </div>
    </div>

    <!-- Interactive Visualization Subsection -->
    <div class="subsection">
      <h3>Interactive Visualization</h3>
      <p class="item-description">
        Explore predicted bat call frequencies across habitats using the interactive plot below. 
        Hover over data points to view detailed information.
      </p>
      <div class="interactive-container">
        <div id="interactivePlot"></div>
      </div>
    </div>

    <!-- Analysis Code Repository -->
    <div class="subsection">
      <h3>Analysis Code</h3>
      <div class="item-container">
        <a href="https://github.com/sacoleman18-cloud/SchmeeckleBatGAMMAnalysis" class="github-link" target="_blank">
          View Full Analysis Repository
        </a>
        <p class="item-description">
          GitHub repository containing the complete R code for the NB GAMM analysis, including data preparation, 
          model fitting, diagnostics, and visualization scripts.
        </p>
      </div>
    </div>
  </div>

  <!-- ============================================
       Interactive Plot Script
       ============================================ -->
  <script>
    // Example placeholder data — replace with your real GAMM predictions
    // This creates an interactive bar chart showing predicted call frequencies by habitat
    const habitats = ['Interior', 'Edge', 'Open'];
    const predictedMeans = [15.2, 22.8, 18.5];
    const lowerCI = [12.1, 19.3, 15.2];
    const upperCI = [18.3, 26.3, 21.8];

    const trace = {
      x: habitats,
      y: predictedMeans,
      type: 'bar',
      error_y: {
        type: 'data',
        symmetric: false,
        array: upperCI.map((upper, i) => upper - predictedMeans[i]),
        arrayminus: predictedMeans.map((mean, i) => mean - lowerCI[i])
      },
      marker: {
        color: ['#3498db', '#2ecc71', '#e74c3c'],
        line: {
          color: '#2c3e50',
          width: 1.5
        }
      },
      hovertemplate: '<b>Habitat:</b> %{x}<br>' +
                     '<b>Predicted calls/night:</b> %{y:.1f}<br>' +
                     '<b>95% CI:</b> [%{customdata[0]:.1f}, %{customdata[1]:.1f}]<extra></extra>',
      customdata: habitats.map((_, i) => [lowerCI[i], upperCI[i]])
    };

    const layout = {
      title: {
        text: 'Predicted Bat Call Frequency by Habitat Type',
        font: { size: 18, color: '#2c3e50' }
      },
      xaxis: {
        title: {
          text: 'Habitat Type',
          font: { size: 14, color: '#555' }
        },
        tickfont: { size: 12 }
      },
      yaxis: {
        title: {
          text: 'Predicted Calls per Night',
          font: { size: 14, color: '#555' }
        },
        tickfont: { size: 12 }
      },
      margin: { t: 60, l: 70, r: 40, b: 60 },
      plot_bgcolor: '#fafafa',
      paper_bgcolor: '#ffffff',
      showlegend: false
    };

    const config = {
      responsive: true,
      displayModeBar: true,
      modeBarButtonsToRemove: ['pan2d', 'lasso2d'],
      displaylogo: false
    };

    Plotly.newPlot('interactivePlot', [trace], layout, config);
  </script>

</body>
</html>
